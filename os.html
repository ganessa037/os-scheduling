<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPU Scheduler</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .gantt-block {
            padding: 10px;
            margin: 2px;
            min-width: 60px;
            text-align: center;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">CPU Scheduler</h1>
        
        <div class="card">
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-4">
                        <label class="form-label">Algorithm</label>
                        <select class="form-select" id="algorithm">
                            <option value="RR">Round Robin (Q=3)</option>
                            <option value="SRT">Shortest Remaining Time</option>
                            <option value="SJN">Shortest Job Next</option>
                            <option value="PP">Preemptive Priority</option>
                        </select>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-4">
                        <label class="form-label">Arrival Times (space-separated)</label>
                        <input type="text" class="form-control" id="arrivalTimes" placeholder="e.g., 0 1 2 3">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Burst Times (space-separated)</label>
                        <input type="text" class="form-control" id="burstTimes" placeholder="e.g., 2 4 6 8">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Priorities (space-separated)</label>
                        <input type="text" class="form-control" id="priorities" placeholder="e.g., 1 2 3 4">
                    </div>
                </div>

                <button class="btn btn-primary" onclick="schedule()">Schedule</button>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-body">
                <h4>Gantt Chart</h4>
                <div id="ganttChart" class="d-flex flex-wrap mt-3"></div>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-body">
                <h4>Results</h4>
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Process</th>
                                <th>Arrival Time</th>
                                <th>Burst Time</th>
                                <th>Completion Time</th>
                                <th>Turnaround Time</th>
                                <th>Waiting Time</th>
                            </tr>
                        </thead>
                        <tbody id="resultsBody"></tbody>
                        <tfoot id="resultsSummary"></tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        function parseInput() {
            const arrivalTimes = document.getElementById("arrivalTimes").value.trim().split(" ").map(Number);
            const burstTimes = document.getElementById("burstTimes").value.trim().split(" ").map(Number);
            const priorities = document.getElementById("priorities").value.trim().split(" ").map(Number);

            const processes = [];
            for (let i = 0; i < arrivalTimes.length; i++) {
                processes.push({
                    id: `P${i}`,
                    arrivalTime: arrivalTimes[i],
                    burstTime: burstTimes[i],
                    remainingTime: burstTimes[i],
                    priority: priorities[i] || 0,
                    completionTime: 0,
                    turnaroundTime: 0,
                    waitingTime: 0
                });
            }
            return processes;
        }

        function schedule() {
            const algorithm = document.getElementById("algorithm").value;
            const processes = parseInput();
            let ganttData = [];

            if (algorithm === "RR") {
                ganttData = roundRobin([...processes], 3);
            } else if (algorithm === "SRT") {
                ganttData = shortestRemainingTime([...processes]);
            } else if (algorithm === "SJN") {
                ganttData = shortestJobNext([...processes]);
            } else if (algorithm === "PP") {
                ganttData = preemptivePriority([...processes]);
            }

            calculateResults(ganttData, processes);
            displayGanttChart(ganttData);
            displayResultsTable(processes);
        }

        function roundRobin(processes, quantum) {
            const ganttData = [];
            let currentTime = 0;
            const queue = [];
            processes.sort((a, b) => a.arrivalTime - b.arrivalTime);

            while (queue.length > 0 || processes.some(p => p.remainingTime > 0)) {
                while (processes.length > 0 && processes[0].arrivalTime <= currentTime) {
                    queue.push(processes.shift());
                }

                if (queue.length === 0) {
                    currentTime++;
                    continue;
                }

                const process = queue.shift();
                const execTime = Math.min(process.remainingTime, quantum);
                ganttData.push({ id: process.id, startTime: currentTime, endTime: currentTime + execTime });
                process.remainingTime -= execTime;
                currentTime += execTime;

                while (processes.length > 0 && processes[0].arrivalTime <= currentTime) {
                    queue.push(processes.shift());
                }

                if (process.remainingTime > 0) queue.push(process);
            }
            return ganttData;
        }

        function shortestRemainingTime(processes) {
            const ganttData = [];
            let currentTime = 0;

            while (processes.some(p => p.remainingTime > 0)) {
                const readyQueue = processes.filter(p => p.arrivalTime <= currentTime && p.remainingTime > 0);
                readyQueue.sort((a, b) => a.remainingTime - b.remainingTime);

                if (readyQueue.length === 0) {
                    currentTime++;
                    continue;
                }

                const process = readyQueue[0];
                ganttData.push({ id: process.id, startTime: currentTime, endTime: ++currentTime });
                process.remainingTime--;
            }
            return ganttData;
        }

        function shortestJobNext(processes) {
            const ganttData = [];
            let currentTime = 0;

            while (processes.length > 0) {
                const readyQueue = processes.filter(p => p.arrivalTime <= currentTime);
                readyQueue.sort((a, b) => a.burstTime - b.burstTime);

                if (readyQueue.length === 0) {
                    currentTime++;
                    continue;
                }

                const process = readyQueue[0];
                ganttData.push({ id: process.id, startTime: currentTime, endTime: currentTime + process.burstTime });
                currentTime += process.burstTime;
                processes.splice(processes.indexOf(process), 1);
            }
            return ganttData;
        }

        function preemptivePriority(processes) {
            const ganttData = [];
            let currentTime = 0;

            while (processes.some(p => p.remainingTime > 0)) {
                const readyQueue = processes.filter(p => p.arrivalTime <= currentTime && p.remainingTime > 0);
                readyQueue.sort((a, b) => a.priority - b.priority);

                if (readyQueue.length === 0) {
                    currentTime++;
                    continue;
                }

                const process = readyQueue[0];
                ganttData.push({ id: process.id, startTime: currentTime, endTime: ++currentTime });
                process.remainingTime--;
            }
            return ganttData;
        }

        function calculateResults(ganttData, processes) {
            const lastEndTimes = {};

            ganttData.forEach(entry => {
                lastEndTimes[entry.id] = entry.endTime;
            });

            processes.forEach(p => {
                p.completionTime = lastEndTimes[p.id];
                p.turnaroundTime = p.completionTime - p.arrivalTime;
                p.waitingTime = p.turnaroundTime - p.burstTime;
            });
        }

        function displayGanttChart(ganttData) {
            const chart = document.getElementById("ganttChart");
            chart.innerHTML = "";

            ganttData.forEach(entry => {
                const block = document.createElement("div");
                block.className = "gantt-block bg-primary";
                block.style.width = `${(entry.endTime - entry.startTime) * 20}px`;
                block.textContent = `${entry.id} (${entry.startTime}-${entry.endTime})`;
                chart.appendChild(block);
            });
        }

        function displayResultsTable(processes) {
            const body = document.getElementById("resultsBody");
            body.innerHTML = "";
            processes.forEach(p => {
                body.innerHTML += `
                    <tr>
                        <td>${p.id}</td>
                        <td>${p.arrivalTime}</td>
                        <td>${p.burstTime}</td>
                        <td>${p.completionTime}</td>
                        <td>${p.turnaroundTime}</td>
                        <td>${p.waitingTime}</td>
                    </tr>`;
            });
        }
    </script>
</body>
</html>
